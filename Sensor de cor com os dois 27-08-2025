
#include <Adafruit_NeoPixel.h>      //Adiciona a biblioteca Adafruit NeoPixel
#define D_in 4       //Nomeia o pino 4 do Arduino
#define qtdeLedsD 1
#define qtdeLedsE 1
#define E_in 3       //Nomeia o pino 3 do Arduino
Adafruit_NeoPixel pixelsD(qtdeLedsD, D_in);     //Instancia o objeto "pixelsD", informando a quantidade e o pino de sinal
Adafruit_NeoPixel pixelsE(qtdeLedsE, E_in);     //Instancia o objeto "pixelsE", informando a quantidade e o pino de sinal
int pinLdrD = A2;
int pinLdrE = A3;

int rdmax, rdmin;
int gdmax, gdmin;
int bdmax, bdmin;

int remax, remin;
int gemax, gemin;
int bemax, bemin;

int lrd,lgd,lbd;

int lre,lge,lbe;

void fazer_leitura_pura() {
  pixelsD.setPixelColor(0, pixelsD.Color(255, 0, 0));     //liga o led correspondente ao número da variável i na cor vermelha
  pixelsE.setPixelColor(0, pixelsE.Color(255, 0, 0));     //liga o led correspondente ao número da variável i na cor vermelha
  pixelsD.show();
  pixelsE.show();
  delay(200);
  lrd = analogRead(pinLdrD);
  lre = analogRead(pinLdrE);
  delay(200);

  pixelsD.setPixelColor(0, pixelsD.Color(0, 255, 0));     //liga o led correspondente ao número da variável i na cor vermelha
  pixelsE.setPixelColor(0, pixelsE.Color(0, 255, 0));     //liga o led correspondente ao número da variável i na cor vermelha
  pixelsD.show();
  pixelsE.show();
  delay(200);
  lgd = analogRead(pinLdrD);
  lge = analogRead(pinLdrE);
  delay(200);

  pixelsD.setPixelColor(0, pixelsD.Color(0, 0, 255));     //liga o led correspondente ao número da variável i na cor vermelha
  pixelsE.setPixelColor(0, pixelsE.Color(0, 0, 255));     //liga o led correspondente ao número da variável i na cor vermelha
  pixelsD.show();
  pixelsE.show();
  delay(200);
  lbd = analogRead(pinLdrD);
  lbe = analogRead(pinLdrE);
  delay(200);
}



void fazer_leitura_normalizada() {
  pixelsD.setPixelColor(0, pixelsD.Color(255, 0, 0));     //liga o led correspondente ao número da variável i na cor vermelha
  pixelsE.setPixelColor(0, pixelsE.Color(255, 0, 0));     //liga o led correspondente ao número da variável i na cor vermelha
  pixelsD.show();
  pixelsE.show();
  delay(60);
  lrd = analogRead(pinLdrD);
  lre = analogRead(pinLdrE);
  lrd = map(lrd, rdmin, rdmax, 0,1023);
  lre = map(lre, remin, remax, 0,1023);
  delay(20);

  pixelsD.setPixelColor(0, pixelsD.Color(0, 255, 0));     //liga o led correspondente ao número da variável i na cor vermelha
  pixelsE.setPixelColor(0, pixelsE.Color(0, 255, 0));     //liga o led correspondente ao número da variável i na cor vermelha
  pixelsD.show();
  pixelsE.show();
  delay(60);
  lgd = analogRead(pinLdrD);
  lge = analogRead(pinLdrE);
  lgd = map(lgd, gdmin, gdmax, 0,1023);
  lge = map(lge, gemin, gemax, 0,1023);
  delay(20);

  pixelsD.setPixelColor(0, pixelsD.Color(0, 0, 255));     //liga o led correspondente ao número da variável i na cor vermelha
  pixelsE.setPixelColor(0, pixelsE.Color(0, 0, 255));     //liga o led correspondente ao número da variável i na cor vermelha
  pixelsD.show();
  pixelsE.show();
  delay(60);
  lbd = analogRead(pinLdrD);
  lbe = analogRead(pinLdrE);
  lbd = map(lbd, bdmin, bdmax, 0,1023);
  lbe = map(lbe, bemin, bemax, 0,1023);
  delay(20);
}


void setup() {
  
  pinMode(pinLdrD, INPUT);
  pinMode(pinLdrE, INPUT);
  pinMode(D_in, OUTPUT);      //Configura o pino 4 como saída
  pinMode(E_in, OUTPUT);      //Configura o pino 3 como saída
  pixelsD.begin();             //Inicia o objeto "pixelsD"
  pixelsE.begin();             //Inicia o objeto "pixelsE"

  pixelsD.clear();  
  pixelsE.clear();
  Serial.begin(9600);
  delay(1000);

  Serial.println("Iniciando processo de calibracao, prepare o branco para leitura...");
  delay(3000);

  fazer_leitura_pura();
  rdmax = lrd;
  gdmax = lgd;
  bdmax = lbd;

  remax = lre;
  gemax = lge;
  bemax = lbe;

  Serial.println("Leitura realizada:");
  Serial.print("rdmax: "); Serial.println(rdmax);
  Serial.print("gdmax: "); Serial.println(gdmax);
  Serial.print("bdmax: "); Serial.println(bdmax);
  Serial.println(" ");
  Serial.print("remax: "); Serial.println(remax);
  Serial.print("gemax: "); Serial.println(gemax);
  Serial.print("bemax: "); Serial.println(bemax);

  delay(3000);

  
  Serial.println("Iniciando processo de calibracao, prepare o preto para leitura...");
  delay(3000);
  
  fazer_leitura_pura();
  rdmin = lrd;
  gdmin = lgd;
  bdmin = lbd;

  remin = lre;
  gemin = lge;
  bemin = lbe;

  Serial.println("Leitura realizada:");
  Serial.print("rdmin: "); Serial.println(rdmin);
  Serial.print("gdmin: "); Serial.println(gdmin);
  Serial.print("bdmin: "); Serial.println(bdmin);
  Serial.println(" ");
  Serial.print("remin: "); Serial.println(remin);
  Serial.print("gemin: "); Serial.println(gemin);
  Serial.print("bemin: "); Serial.println(bemin);

  delay(3000);
}

void loop() {

  //desliga todos os LEDs

  fazer_leitura_normalizada();

  Serial.print("Vermelho D: "); Serial.println(lrd);
  Serial.print("Verde D: "); Serial.println(lgd);
  Serial.print("Azul D: "); Serial.println(lbd);
  Serial.println(" ");
  Serial.print("Vermelho E: "); Serial.println(lre);
  Serial.print("Verde E: "); Serial.println(lge);
  Serial.print("Azul E:  "); Serial.println(lbe);
  Serial.println(" ");
  
}
